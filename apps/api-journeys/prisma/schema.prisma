// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "../../../node_modules/.prisma/api-journeys-client"
}

enum ThemeMode {
  light
  dark
}

enum ThemeName {
  base
}

model Journey {
  id        String     @id @default(uuid())
  title     String
  published Boolean    @default(false)
  blocks    Block[]
  locale    String     @default("en-US")
  themeMode ThemeMode  @default(light)
  themeName ThemeName  @default(base)
  description String?
  primaryImageBlockId String?
  primaryImageBlock Block?    @relation("PrimaryImageJourney", fields: [primaryImageBlockId], references: [id])
  // add slug with string unique index not nullable
  // in migration:
  // 1. add a slug column with type string to journey with a unique index
  // 2. generate slug for all existing journeys
  // 3. make field not nullable
  slug      String    @unique
}

enum BlockType {
  ButtonBlock
  CardBlock
  ImageBlock
  RadioOptionBlock
  RadioQuestionBlock
  SignUpBlock
  StepBlock
  TypographyBlock
  VideoBlock
}

model Block {
  id            String    @id @default(uuid())
  blockType     BlockType @default(StepBlock)
  journey       Journey   @relation(fields: [journeyId], references: [id])
  journeyId     String
  parentBlock   Block?    @relation("BlockChildren", fields: [parentBlockId], references: [id])
  parentBlockId String?
  childBlocks   Block[]   @relation("BlockChildren")
  primaryImageJourney   Journey?   @relation("PrimaryImageJourney")
  extraAttrs    Json?
  parentOrder   Int       @default(0)
  responses     Response[]
}

enum ResponseType {
  RadioQuestionResponse
  SignUpResponse
  VideoResponse
}

model Response {
  id            String       @id @default(uuid())
  type          ResponseType
  userId        String
  block         Block        @relation(fields: [blockId], references: [id])
  blockId       String
  extraAttrs    Json
}